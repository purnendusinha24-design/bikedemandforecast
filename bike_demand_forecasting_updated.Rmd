---
title: "Forecast Daily Bike Rental Demand Using Time Series Models"
author: "Purnendu kumar sinha"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 7,
  fig.height = 4.5
)
```

# Introduction

In this project, we analyze bike rental data from the Capital Bikeshare system in Washington, DC (2011–2012) and build time series models to forecast future **daily** rental demand.

Accurate forecasts can help the bike rental company:

- plan how many bikes to keep available,
- improve station-level fleet management,
- inform pricing and promotions, and
- optimize logistics and reduce costs.

We will load, clean, explore, model, and forecast.

# Libraries

```{r}
library(tidyverse)
library(lubridate)
library(forecast)
```

# Load Data

Make sure `day.csv` from the Bike Sharing Dataset is in the same folder as this Rmd file.

```{r}
daily <- read_csv("day.csv")
glimpse(daily)
```

# Clean and Prepare Data

```{r}
daily <- daily %>%
  mutate(
    date = ymd(dteday),
    year = factor(yr, labels = c("2011","2012")),
    month = factor(mnth),
    weekday = factor(weekday)
  ) %>%
  arrange(date)

summary(select(daily, cnt, temp, hum, windspeed))
```

# Exploratory Data Analysis

## Daily rentals over time

```{r}
ggplot(daily, aes(x = date, y = cnt)) +
  geom_line(color = "#2563EB") +
  labs(
    title = "Daily Bike Rentals (2011–2012)",
    x = "Date",
    y = "Total rentals (cnt)"
  ) +
  theme_minimal()
```

## Monthly pattern

```{r}
daily %>%
  group_by(year, mnth) %>%
  summarise(avg_cnt = mean(cnt), .groups = "drop") %>%
  ggplot(aes(x = mnth, y = avg_cnt, group = year, color = year)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = 1:12) +
  labs(
    title = "Average Daily Rentals by Month and Year",
    x = "Month",
    y = "Average rentals"
  ) +
  theme_minimal()
```

# Time Series Object and Decomposition

We now create a daily time series for the whole period and decompose it into trend, seasonal, and remainder components.

```{r}
bike_ts <- ts(daily$cnt, frequency = 365)
bike_ts

plot(bike_ts,
     main = "Daily Bike Rentals Time Series",
     xlab = "Time",
     ylab = "Rentals (cnt)")
```

```{r}
bike_stl <- stl(bike_ts, s.window = "periodic")
plot(bike_stl, main = "STL Decomposition of Daily Bike Rentals")
```

# Train / Test Split

We hold out the last 90 days as a test set to evaluate forecast accuracy.

```{r}
test_horizon <- 90
n <- length(bike_ts)

train_ts <- ts(bike_ts[1:(n - test_horizon)],
               frequency = frequency(bike_ts))
test_vec <- bike_ts[(n - test_horizon + 1):n]

length(train_ts); length(test_vec)
```

> Note: we keep the **training data** as a time series object, but treat the **test data** as a numeric vector. This avoids alignment issues when comparing forecasts to actuals.

# Baseline Models

We first fit simple baseline models:

- **Naive**: the forecast is the last observed value  
- **Seasonal naive**: the forecast repeats the last observed value from the same season

```{r}
naive_fit  <- naive(train_ts,  h = test_horizon)
snaive_fit <- snaive(train_ts, h = test_horizon)

autoplot(naive_fit) +
  autolayer(ts(test_vec, start = end(train_ts)[1] + end(train_ts)[2]/frequency(train_ts),
               frequency = frequency(train_ts)),
            series = "Test") +
  labs(
    title = "Naive Forecast vs Test Data",
    x = "Time",
    y = "Rentals"
  )
```

```{r}
naive_acc  <- accuracy(naive_fit$mean,  test_vec)
snaive_acc <- accuracy(snaive_fit$mean, test_vec)

baseline_results <- rbind(
  Naive          = naive_acc[ , c("RMSE", "MAE", "MAPE")],
  Seasonal_Naive = snaive_acc[ , c("RMSE", "MAE", "MAPE")]
)

baseline_results
```

# ARIMA Model

We now fit an ARIMA model on the training data using `auto.arima()`.

```{r}
arima_fit <- auto.arima(train_ts)
arima_fit
```

```{r}
fc_arima <- forecast(arima_fit, h = test_horizon)

autoplot(fc_arima) +
  autolayer(ts(test_vec, start = end(train_ts)[1] + end(train_ts)[2]/frequency(train_ts),
               frequency = frequency(train_ts)),
            series = "Test") +
  labs(
    title = "ARIMA Forecast vs Test Data",
    x = "Time",
    y = "Rentals"
  )
```

```{r}
arima_acc <- accuracy(fc_arima$mean, test_vec)
arima_acc[ , c("RMSE", "MAE", "MAPE")]
```

# ETS Model

We also fit an exponential smoothing (ETS) model for comparison.

```{r}
ets_fit <- ets(train_ts)
ets_fit
```

```{r}
fc_ets <- forecast(ets_fit, h = test_horizon)

autoplot(fc_ets) +
  autolayer(ts(test_vec, start = end(train_ts)[1] + end(train_ts)[2]/frequency(train_ts),
               frequency = frequency(train_ts)),
            series = "Test") +
  labs(
    title = "ETS Forecast vs Test Data",
    x = "Time",
    y = "Rentals"
  )
```

```{r}
ets_acc <- accuracy(fc_ets$mean, test_vec)
ets_acc[ , c("RMSE", "MAE", "MAPE")]
```

# Model Comparison

```{r}
model_comparison <- rbind(
  Naive          = naive_acc[ , c("RMSE", "MAE", "MAPE")],
  Seasonal_Naive = snaive_acc[ , c("RMSE", "MAE", "MAPE")],
  ARIMA          = arima_acc[ , c("RMSE", "MAE", "MAPE")],
  ETS            = ets_acc[ , c("RMSE", "MAE", "MAPE")]
)

model_comparison
```

The model with the **lowest RMSE and MAPE** is generally preferred for forecasting.

# Final Model and Future Forecast

Assuming the ARIMA model performs best (update if ETS is better), we refit ARIMA on the **full series** and forecast the next 30 days.

```{r}
final_arima <- auto.arima(bike_ts)
final_arima
```

```{r}
final_fc <- forecast(final_arima, h = 30)

autoplot(final_fc) +
  labs(
    title = "30-Day Forecast of Daily Bike Rentals",
    x = "Time",
    y = "Forecasted rentals"
  )
```

```{r}
head(data.frame(
  Day = 1:30,
  Forecast = round(final_fc$mean)
), 10)
```

# Insights and Recommendations

Based on this analysis and the forecasting results:

- Daily bike rentals show a clear **upward trend** between 2011 and 2012.
- There is strong **seasonality**, with higher demand in warmer months.
- Weather variables such as temperature and humidity influence demand.
- ARIMA and ETS models outperform naive baselines, providing more accurate forecasts.

From a business perspective, the company can:

- increase fleet size and staff coverage ahead of predicted high-demand periods,
- consider dynamic pricing, with higher prices on forecasted peak days,
- schedule maintenance and rebalancing during forecasted low-demand windows.

# Conclusion

We loaded, cleaned, and explored the Capital Bikeshare daily rental data, built several time series forecasting models (Naive, Seasonal Naive, ARIMA, ETS), and compared their accuracy on a test set. We then used the best-performing model to forecast future demand and translated these results into actionable recommendations for fleet management and pricing strategy.
